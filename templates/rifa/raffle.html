<!DOCTYPE html>        
<html lang="pt-br">        
<head>        
    <meta charset="UTF-8">        
    <meta http-equiv="X-UA-Compatible" content="IE=edge">        
    <meta name="viewport" content="width=device-width, initial-scale=1.0">        
    <title>SAV AWARDS | Rifa digital</title>        
    <link rel="stylesheet" href="{{ url_for('static', filename='css/raffle-dark.css') }}">        
    <link rel="preconnect" href="https://fonts.googleapis.com">        
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>        
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">        
    <style>
     video {
        width: 100%;
        height: 100%; /* Mantém a proporção do vídeo */
        max-width: 800px; /* Define um tamanho máximo opcional */
    }
    </style>
    <script>        
        // Valor do ticket        
        ticketValue = 0.05;        
                  
    </script>        
    <style>   


     .organizer-tags img {
               /* Efeito Neon (sombra) */
              box-shadow:
              0 0 10px #8a2be2,   /* Brilho interno suave */
              0 0 40px #8a2be2,   /* Brilho externo mais forte */
              0 0 80px #8a2be2;   /* Brilho ainda mais espalhado */
              text-shadow:
              0 0 5px #fff,       /* Brilho no texto */
              0 0 10px #8a2be2;
               }
              }


              .main-image {
                  position: relative;
                  display: inline-block;
                 
              }
      
              .main-image .center-image {
                  position: absolute;
                  top: 50%;
                  left: 50%;
                  transform: translate(-50%, -50%);
                  width: 200px;
                  height: auto;
                  border-radius:none;
                  pointer-events: none;
              }

                                 
      .my-tickets {
          display: flex;
          max-width: 1000px;
          width: 100%;
          user-select: none;
         
      }
      
      .my-tickets a {
          display: flex;
          justify-content: center;
          align-items: center;
          font-size: 15px;
          font-weight: 600;
          text-transform: uppercase;
          background-color: white;
          color: #8b8b8b;
          border: 1px solid #dbdbdb;
          border-radius: 9px;
          text-decoration: none;
          width: 100%;
          padding: 12px 20px;
          margin-bottom: 10px;
      }

      .valor-final {
      	text-align:center;
      	color:gold;
      	font-size:32px;
      	font-family:monospace;
      }
      .see-tickets {
          display: flex;
          justify-content: center;
          font-size: 17px;
          font-weight: 500;
          text-transform: uppercase;
          color: white;
          border-radius: 7px;
          cursor: pointer;
          user-select: none;
          padding: 12px;
          margin-top: 12px;
          transition: all 0.2s;
      }
      
      .see-tickets:hover {
          background-color: #f3f3f3;
          color: #000000;
          border-radius: 9px 9px 25px 25px;
          transition: all 0.2s;
      }
      
      .ticket-numbers {
          opacity: 0;
          visibility: hidden;
          height: 0;
          max-height: 260px;       /* <-- limite pra não explodir */
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          justify-content: center;
          transition: all 0.3s;
          overflow-y: auto;        /* <-- scroll vertical funcionando */
          overflow-x: hidden;
          padding: 0;
      }
      
        
             
      .ticket-numbers input {
          font-size: 15px;
          color: #474747;
          border: 1px solid #6f6f6f;
          border-radius: 7px;
          min-width: 44px;
          text-align: center;
          text-align: -webkit-center;
          padding: 8px;
          margin: 0 5px 5px 0;
          gap:5px;
          height: auto;
          
      }
      
      .ticket-numbers p:last-child {
          margin-right: 0;
      }
      
     .visible {
         height: auto;
         max-height: 260px; 
         visibility: visible;
         opacity: 1;
         margin: 28px 22px;
     }
      
      
      
      
      .my-tickets a:hover {
          background-color: #f6f6f6;
      }
      
      .my-tickets a img {
          filter: invert(46%) sepia(0%) saturate(6746%) hue-rotate(273deg) brightness(115%) contrast(77%);
          height: 16px;
          margin-right: 11px;
      }

      strong {
      	font-family:monospace;
      	color:gold;
      }

      p {
      	font-family:monospace;
      	color:blue;
      }
      b {
      	color:gold;
      }
      
    </style>        
</head>        
<body>        
<div id="overlay-blur-effect"></div>        
        
<!-- Header -->        
<header>        
    <div class="logo">        
        <a href="#">        
                <img src="https://res.cloudinary.com/doik0qtfr/image/upload/v1765756283/file_000000001b0071f58bcbc51e9c9d664d_rnlva3.png" alt="Logo" draggable="false">
        </a>        
    </div>        
</header>        
<!-- Header -->        
        
<main>        
    <div class="main-container">        
        <div class="search-tickets-overlay">        
            <form action="#">        
                <div class="search-tickets-container">        
                    <div class="search-tickets-box">        
                        <label for="search-tickets">Buscar bilhetes</label>        
                        <img id="close-search-tickets" src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290948/close-icon_vwjg9s.svg" alt="Fechar">        
                        <input id="search-tickets" type="email" placeholder="Digite seu e-mail" required>        
                        <button type="submit">Buscar</button>   
                        
 
                    </div>        
                </div>        
            </form>        
        </div>        
        
        <div class="my-tickets">        
            <a href="#" onclick="toggleSearchTickets()">        
                <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290955/search-icon_i5fixk.svg" draggable="false">        
                Buscar meus bilhetes        
            </a>        
        </div>        
        
        <div class="raffle">        
            <div class="main-image">        
                <!-- <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290910/money_hyk7vf.jpg" alt="Rifa em Destaque">         -->
                <video controls width="600">
                <source src="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                Seu navegador não suporta vídeo.
              </video>
                <!-- Imagem menor no centro -->        
                <!-- <img class="center-image" src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764599109/FB_IMG_1764597201315-removebg-preview_eptaed.png" alt="Imagem Menor"> -->        
                        
                <div class="main-statement"><b>por</b> <h4>R$2.50</h4> cada número</div>        
            </div>        
        
           
        
            <div class="raffle-organizer">        
                <div class="organizer-image">        
                    <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764599109/FB_IMG_1764597201315-removebg-preview_eptaed.png" alt="Organizador da Rifa">        
                </div>        
                <div class="organizer-info">        
                    <p>Organizado por:</p>        
                    <h4>Diego Ruany</h4>        
                    <div class="organizer-tags">        
                        <a href="https://chat.whatsapp.com/DGD7PMP8WBaESR6MWEpo9M" target="_blank">        
                            <div class="tag support">        
                                <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290957/whatsapp-icon_lswp1j.svg">        
                                <span>Suporte</span>        
                            </div>        
                        </a>        
                        <a href="#" target="_blank">        
                            <div class="tag telegram">        
                                <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290956/telegram-icon_nned8r.svg">        
                                <span>Telegram</span>        
                            </div>        
                        </a>        
                        <a href="#" target="_blank">        
                            <div class="tag instagram">        
                                <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290950/instagram-icon_a8uutz.svg">        
                                <span>Instagram</span>        
                            </div>        
                        </a>        
                    </div>        
                </div>        
            </div>        
        
            <div class="awards"></div>        
        
            <div class="raffle-description">  
                    
                <h4>Descrição / Regulamento</h4>        
                <p id="data_sorteio">Data Sorteio:<strong>{{dataProximoConcurso}}</strong></p>  
                <p id="sorteio">Sorteio:<strong>{{proximoConcurso}}</strong></p> 
                <p id="valor_premio">Valor Premio:<strong>R$300,00</strong></p> 
                <strong>O vencedor será definido no primeiro prêmio da loteria federal!</strong>        
                <p>O que comprar mais números leva: <b>R$ 50,00</b></p>        
            </div>        
        
            <div class="raffle-ranking">        
                <h4>Classificação dos colaboradores</h4>        
                <div class="podium">        
                    <div class="rank">        
                        <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290950/gold-medal_jdgwm3.svg" alt="Top 1" draggable="false">        
                        <p>{{nome_organizador1}}</p>        
                        <p><b>{{bilhetes1}}</b> bilhetes</p>        
                    </div>        
                    <div class="rank">        
                        <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290956/silver-medal_odyw6y.svg" alt="Top 2" draggable="false">                                           
                        <p>{{nome_organizador2}}</p>        
                        <p><b>{{bilhetes2}}</b> bilhetes</p>        
                    </div>        
                    <div class="rank">        
                        <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290948/bronze-medal_bunwsf.svg" alt="Top 3" draggable="false">        
                        <p>{{organizador3}}</p>        
                        <p><b>{{bilhetes3}}</b> bilhetes</p>        
                    </div>        
                </div>        
            </div>        
           
            <div class="raffle-tickets">   
               <h4>saldo:{{balance}} </h4>  
                <h4>SELECIONE A QUANTIDADE DE BILHETES</h4>        
                <section class="add-tickets-container">        
                    <div class="add-tickets-box">        
                        <div class="add-tickets">        
                            <div id="add-one-ticket" class="qty-btn">+1</div>        
                            <div id="add-five-ticket" class="qty-btn">+5</div>        
                            <div id="add-ten-ticket" class="qty-btn">+10</div>        
                            <div id="add-hundred-ticket" class="qty-btn">+100</div>        
                        </div>        
                        <div class="quantity-container">        
                            <div class="quantity-box">        
                                <div class="decrease" id="decreaseValue"><span>-</span></div>        
                                <input id="quantityValue" type="text" value="1" maxlength="12">        
                                <div class="increase" id="increaseValue"><span>+</span></div>        
                            </div>        
                            <p id="quantity-error">Insira um valor acima de 0</p>        
                        </div>        
                        <div class="total">        
                            <div>Valor final</div>        
                            <div id="total-value">R$ 0,00</div>        
                        </div>        
                        <div class="purchase">        
                            <div class="purchase-overlay">        
                                <form action="#">        
                                    <div class="purchase-tickets-container">        
                                        <div class="purchase-tickets-box">        
                                            <img id="close-purchase-tickets" src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290948/close-icon_vwjg9s.svg" alt="Fechar">        
                                            <label>Compras</label>        
                                            <div id="see-tickets" class="see-tickets">
                                             <span>Escolhas seus numeros e boa sorte.</span>
                                             </div>
                                             
                                             <div id="ticket-numbers" class="ticket-numbers">
                                             <input type="number" name="tickets[]" placeholder="000 a 999">                                             
                                             </div>
                                            <strong class="valor-final" id="total-final" >0,00</strong>        
                                            <div class="terms">        
                                                <input name="terms" type="checkbox" required>        
                                                <p>Li e concordo com os <a href="#" target="_blank">Termos e Condições</a> e estou ciente de que essa reserva me vincula apenas à esta campanha criada pelo(a) organizador(a) e NÃO à plataforma.</p>        
                                            </div>        
                                            <a class="purchase-submit-btn" href="/review/users/{{user_id}}">Verificar Bilhetes</a>        
                                        </div>        
                                    </div>        
                                </form>        
                            </div>        
                            <button onclick="checkQuantity()">Selecione seu numeros</button>        
                        </div>        
                    </div>        
                </section>        
            </div>        
        
            <div class="raffle-duals">        
                <div class="raffle-payment-method">        
                    <h4>Método de Pagamento</h4>        
                    <div class="raffle-text">        
                        <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290951/pix-icon_ixm2o0.svg" alt="Pix" draggable="false">        
                    </div>        
                </div>        
                <div class="raffle-origin">        
                    <h4>Sorteio</h4>        
                    <div class="raffle-text">        
                        <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290951/loterias-caixa-logo_u3arzq.png" alt="Loterias Caixa" draggable="false">        
                    </div>        
                </div>        
            </div>        
        </div>        
    </div>        
</main>        
        
<script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-masker/1.2.0/vanilla-masker.min.js"></script>
<script>
window.USER_ID = "{{ user_id }}";
VMasker(document.getElementById("phone-number")).maskPattern("(99) 99999-9999");
</script>

<script src="{{ url_for('static', filename='js/search-tickets.js') }}"></script>
<script src="{{ url_for('static', filename='js/add-raffle.js') }}"></script>
<script src="{{ url_for('static', filename='js/purchase-tickets.js') }}"></script>
<script src="{{ url_for('static', filename='js/see-tickets.js') }}"></script>


<!-- ENVIO DA COMPRA PARA O BACKEND (NÃO MEXE EM MAIS NADA) -->
<script>
document.querySelector(".purchase-submit-btn").addEventListener("click", async (e) => {
    e.preventDefault();

    const userId = window.USER_ID;

    const tickets = Array.from(document.querySelectorAll("#ticket-numbers input"))
        .map(i => i.value)
        .filter(v => v !== "");

    const quantity = document.getElementById("quantityValue").value;
    const valorTotal = document.getElementById("total-final").textContent
        .replace("R$", "")
        .replace(".", "")
        .replace(",", ".");
    
    const valorUnit = ticketValue;

    const body = {
        data_sorteio: data_sorteio,
        tickets: tickets,
        valor: parseFloat(valorTotal),
        quantity: parseInt(quantity),
        valor_unit: valorUnit
    };

    const response = await fetch(`/compras_rf/${userId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
    });

    const json = await response.json();

    if (response.status === 201) {
        window.location.href = `/review/users/${userId}`;
    } else {
        alert(json.error || "Erro ao registrar compra");
    }
});
</script>


<!-- GERADOR DE INPUTS — INTACTO DO JEITO QUE VOCÊ JÁ TINHA -->
<script>
(function(){
  const quantityEl = document.getElementById('quantityValue');
  const ticketNumbersWrapper = document.getElementById('ticket-numbers');

  function normalizeCount(v){
    const n = parseInt(String(v).replace(/\D/g,''), 10);
    return (isNaN(n) || n < 1) ? 1 : n;
  }

  function clearTickets(){
    ticketNumbersWrapper.innerHTML = "";
  }

  function padNumber(num){
    return String(num).padStart(3, '0');
  }

  function renderTicketInputs(count){
    clearTickets();
    for(let i = 0; i < count; i++){
      const inp = document.createElement('input');
      inp.type = 'number';
      inp.name = 'ticket[]';
      inp.placeholder = padNumber(i+1);
      inp.min = 0;
      inp.max = 999;
      inp.className = 'ticket-input';
      inp.addEventListener('blur', () => {
        if (inp.value !== '') {
          const v = Number(inp.value);
          if (!Number.isNaN(v)) inp.value = padNumber(v);
        }
      });
      ticketNumbersWrapper.appendChild(inp);
    }
    ticketNumbersWrapper.classList.add('visible');
  }

  // inicial
  if(quantityEl){
    renderTicketInputs(normalizeCount(quantityEl.value));

    quantityEl.addEventListener('input', () => {
      renderTicketInputs(normalizeCount(quantityEl.value));
    });
  }

  // botões +1 +5 +10 +100
  document.querySelectorAll('.qty-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const txt = (btn.textContent || '').trim();
      const m = txt.match(/\+(\d+)/);
      const inc = m ? parseInt(m[1],10) : 0;
      const current = normalizeCount(quantityEl.value);
      quantityEl.value = current + inc;
      quantityEl.dispatchEvent(new Event('input', {bubbles: true}));
    });
  });
})();
</script>
</body>        
</html>        
         
      
      
