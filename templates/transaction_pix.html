<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/transaction_pix.css') }}"> -->
        
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <title>SAV AWARDS | Pix</title>
    <style>
   * {
       padding: 0;
       margin: 0;
       font-family: 'Roboto', sans-serif;
   }
   
   body {
       background-color: #fafafa;
       
       
   }
   
   
   header {
       display: flex;
       flex-direction: column;
       justify-content: center;
       align-items: center;
       background-color: #152126;
       border-bottom: 1px solid #373737;
       
   }
   
   .logo a {
       display: flex;
       user-select: none;
       padding: 20px;
   }
   
   .logo img {
       height: 60px;
       max-width: 60px;
       background:#fff;
       border-radius:50%;
       box-shadow:
        0 0 10px #8a2be2,   /* Brilho interno suave */
        0 0 40px #8a2be2,   /* Brilho externo mais forte */
        0 0 80px #8a2be2;   /* Brilho ainda mais espalhado */
        text-shadow:
        0 0 5px #fff,       /* Brilho no texto */
        0 0 10px #8a2be2;
       }
   }
   
   .logo img:hover {
       filter: grayscale(1);
       transition: all 0.2s;
   }
   
   /* End Header */
   
   
   
   main {
       display: flex;
       justify-content: center;
   }
   
   .pix-container {
       display: flex;
       justify-content: center;
       padding: 1px;
       
   }
   
   .payment {
       display: flex;
       flex-direction: column;
       align-items: center;
       max-width: 306px;
       background-color:#fff;
       border-radius: 8px;
       box-shadow: 0 0 17px -6px #00000026;
       text-align: center;
       text-align: -webkit-center;
       padding: 46px 49p;
       
   }
   
   .payment span {
       font-size: 15px;
   }
   
   .payment p {
       font-size: 15px;
       font-weight: 500;
   }
   
   .payment p b {
       color: #549ddb;
       font-weight: 900;
   }
   
   
   .qrcode-info {
       display: flex;
       align-items: center;
       margin: 44px 0 12px 0;
   }
   
   .qrcode-info img {
       user-select: none;
       height: 18px;
       filter: invert(41%) sepia(1%) saturate(0%) hue-rotate(182deg) brightness(91%) contrast(81%);
       margin-right: 10px;
   }
   
   .qrcode-info span {
       font-size: 14px;
       color: #666666;
       font-weight: 500;
   }
   
   .qrcode img {
       user-select: none;
       max-width: 220px;
       width: 100%;
   }
   
   .pix-value {
       font-size: 17px;
       margin: 19px 0;
       font-weight: 800;
   }
   
   .pix-value strong {
       color: #111;
       font-weight: 800;
   }
   
   
   /* #copy-mobile { */
   /*     display: none; */
   /*     box-sizing: border-box; */
   /* } */
   .pix-copy-mobile {
       cursor: pointer;
       user-select: none;
       display: flex;
       justify-content: center;
       align-items: center;
       color: #ffffff;
       font-size: 14px;
       font-weight: 600;
       width: 100%;
       background-color: blue;
       border-radius: 8px;
       padding: 15px 15px;
   }
   .pix-copy-mobile img {
       height: 17px;
       filter: invert(100%) sepia(100%) saturate(0%) hue-rotate(288deg) brightness(102%) contrast(102%);
       margin-right: 13px;
   }
   
   .pix-copy-and-past span {
       display: block;
       color: #666666;
       font-size: 14px;
       margin: 35px 0 15px 0;
   }
   .qrcode-text {
       position: relative;
       background-color: #FFFFD1;
       padding: 8px;
       border: 3px dotted #666666;
   }
   .qrcode-text:hover img {
       display: block;
   }
   .qrcode-text img {
       display: none;
       height: 19px;
       width: 19px;
       position: absolute;
       right: 0;
       top: 0;
       background-color: #ffffd1;
       border-radius: 5px;
       cursor: pointer;
       z-index: 2;
       padding: 9px;
   }
   #qrcode-text {
       font-size: 14px;
       color: #666666;
       word-break: break-all;
       user-select: all;
   }
   #copy {
       user-select: none;
   }
   #copied-code {
       opacity: 0;
       visibility: hidden;
       position: absolute;
       font-size: 14px;
       background-color: #363636;
       color: #ffffff;
       border-radius: 8px;
       top: 50%;
       left: 50%;
       transform: translate(-50%, -50%);
       transition: all 0.3s;
       user-select: none;
       padding: 10px;
       z-index: 2;
   }
   
   
   @media (max-width: 730px) {
       .pix-container {
           margin-top: 0;
       }
       .payment span {
           font-size: 16px;
       }
       .pix-value {
           font-size: 20px;
       }
   
       #copy-mobile {
           display: flex;
       }
       .qrcode-tutorial, .qrcode-info, #copy {
           display: none;
       }
   }
   
   @media (max-width: 500px) {
       .pix-container {
           padding: 15px;
       }
       .payment {
           max-width: none;
           padding: 46px 30px;
       }
   }
   
  
   
   
  
   
   
   
    </style>

   

    
</head>

<body>

<header>
    <div class="logo">
        <a href="#">
      <img src="https://res.cloudinary.com/doik0qtfr/image/upload/v1765756283/file_000000001b0071f58bcbc51e9c9d664d_rnlva3.png" alt="Logo do sistema">

        </a>
    </div>
</header>

<main>
    <div class="pix-container">
        <div class="payment">

            <div id="notifications"></div>

            <p>Abra seu aplicativo de pagamento e escolha <b>Ler QR Code</b></p>
            <span>Aponte a câmera do seu celular</span>
            <div id="status-area">
                    <!-- Atualizações de status aparecerão aqui -->
             </div>
            <div class="qrcode-info">
                <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290948/cellphone-icon_remhjc.svg" draggable="false">
            </div>

            <div class="qrcode">
                <img src="{{ qrcode }}" alt="QR CODE">
            </div>
            <div class="pix-value">
             <strong>FERRARI GAMES ITECH IO</strong>
             </div>
           

            <div class="pix-value">
                <strong>{{ valor }}</strong>
            </div>

            <div class="pix-value">
                <strong>{{ payment_id }}</strong>
            </div>

            
            
            
            <div id="copy-mobile" class="pix-copy-mobile">
                <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290949/copy-icon_z8ur77.svg" draggable="false">
                <span>Copiar código</span>
            </div>

            <div class="pix-copy-and-past">
                <span>Você também pode pagar usando <b>Pix Copia e Cola</b>. Copie o código abaixo:</span>
                <div class="qrcode-text">
                    <img id="copy" src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290949/copy-icon_z8ur77.svg" draggable="false">
                    <div id="copied-code">Código copiado.</div>
                    <p id="qrcode-text">{{ qr_code_cola }}</p>
                </div>
            </div>

        </div>
    </div>
</main>


<script src="{{ url_for('static', filename='js/see-tickets.js') }}"></script>
 <!-- SOCKET.IO CDN -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {

    const copyBtn = document.getElementById("copy");
    const copyMobileBtn = document.getElementById("copy-mobile");
    const qrcodeText = document.getElementById("qrcode-text");
    const copiedCodeBox = document.getElementById("copied-code");

    function copiarPix() {
        const text = qrcodeText.textContent.trim();
        if (!text) return;

        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);

        copiedCodeBox.textContent = "Código copiado!";
        copiedCodeBox.style.display = "block";
        copiedCodeBox.style.opacity = "1";
        copiedCodeBox.style.background = "#16a34a";
        copiedCodeBox.style.color = "#fff";
        copiedCodeBox.style.padding = "8px 12px";
        copiedCodeBox.style.borderRadius = "6px";

        setTimeout(() => copiedCodeBox.style.opacity = "0", 1500);
    }

    copyBtn.onclick = copiarPix;
    copyMobileBtn.onclick = copiarPix;
});




  

   
        // Conectar ao servidor Socket.IO
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        // Ouvir o evento 'payment_update'
        socket.on('payment_update', function(data) {
            console.log('Atualização recebida:', data);
            var statusArea = document.getElementById('status-area');
            var p = document.createElement('p');
            p.textContent = 'Pagamento ID: ' + data.payment_id + ' - Novo Status: ' + data.status;
            statusArea.appendChild(p);
        });





// ===== SOCKET.IO =====
<!-- const paymentId = "{{ payment_id }}"; -->
<!-- const userId = "{{ user_id }}"; -->
<!-- const socket = io(window.location.origin); -->
<!--  -->
<!-- socket.on("connect", () => { -->
<!--     socket.emit("join_payment", { payment_id: paymentId }); -->
<!-- }); -->
<!--  -->
<!-- socket.on("payment_update", (data) => { -->
<!--     if (data.payment_id !== paymentId) return; -->
<!--  -->
<!--     const div = document.getElementById("notifications"); -->
<!--     div.innerHTML = ""; -->
<!--  -->
<!--     const p = document.createElement("p"); -->
<!--  -->
<!--     if (data.status === "approved") { -->
<!--         p.style.color = "green"; -->
<!--         p.innerText = "✅ Pagamento aprovado!"; -->
<!--         div.appendChild(p); -->
<!--  -->
<!--         setTimeout(() => { -->
<!--             window.location.href = `/carregar/atualizar/compra/sucesso/users/${userId}`; -->
<!--         }, 3000); -->
<!--  -->
<!--     } else if (data.status === "rejected") { -->
<!--         p.style.color = "red"; -->
<!--         p.innerText = "❌ Pagamento recusado!"; -->
<!--         div.appendChild(p); -->
<!--  -->
<!--         setTimeout(() => { -->
<!--             window.location.href = `/compra/recusada/${userId}`; -->
<!--         }, 3000); -->
<!--     } -->
<!-- }); -->
</script>

</body>
</html>
