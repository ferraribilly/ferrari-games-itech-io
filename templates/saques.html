<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Saques - Pix</title>
  
 <style>
 *{margin:0;padding:0;box-sizing:border-box}
 
 html,body{
     width:100%;
     height:100%;
     overflow-x:hidden;
 }
 
 body{
     background:#1e1e1e;
     font-family:monospace;
     color:#fff;
 }
 
 /* HEADER */
 header{
     width:100%;
     background:#0f1720;
     border-bottom:1px solid #2b2b2b;
     display:flex;
     justify-content:center;
     align-items:center;
     padding:30px 0;
 }
 
 .logo img{
     width:70px;
     height:70px;
     border-radius:50%;
     background:#fff;
     box-shadow:0 0 10px #8a2be2,0 0 30px #8a2be2;
 }
 
 /* CONTAINER */
 .dashboard-container{
     width:100%;
     max-width:480px;
     margin:20px auto 120px;
     padding:16px;
     background:#111827;
     border-radius:14px;
     box-shadow:0 10px 30px rgba(0,0,0,.5);
     display:flex;
     flex-direction:column;
     gap:16px;
 }
 
 /* MAIN */
 main{
     width:100%;
 }
 
 /* SALDO */
 .balance-card{
     width:100%;
     background:#0b1220;
     border-radius:14px;
     padding:16px;
     text-align:center;
     display:flex;
     flex-direction:column;
     gap:10px;
 }
 
 .balance-amount{
     font-size:1.8rem;
     font-weight:bold;
     color:#00aaff;
 }
 
 /* SAQUE */
 .withdraw-section{
     width:100%;
     display:flex;
     flex-direction:column;
     gap:12px;
 }
 
 .pix-logo{
     display:flex;
     justify-content:center;
 }
 
 .pix-logo img{
     height:36px;
 }
 
 .pix-area{
     display:flex;
     flex-direction:column;
     gap:10px;
 }
 
 .pix-area input,
 .pix-area button{
     width:100%;
     padding:12px;
     border-radius:8px;
     border:none;
     font-size:14px;
 }
 
 .pix-area input{
     background:#fff;
     color:#000;
 }
 
 .withdraw-btn{
     background:#22c55e;
     color:#fff;
     font-weight:bold;
 }
 
 .withdraw-btn:active{
     transform:scale(.98);
 }

 h2 {
 	text-align:center;
 }
 
 /* FOOTER */
 .footer{
     position:fixed;
     bottom:0;
     left:0;
     width:100%;
     background:#0f1720;
     border-top:1px solid #2b2b2b;
     padding:10px 8px;
 }
 
 .footer-content{
     max-width:480px;
     margin:0 auto;
     display:flex;
     flex-direction:column;
     align-items:center;
     gap:8px;
     text-align:center;
 }
 
 .footer-logos img{
     height:26px;
 }
 
 .footer-text{
     font-size:11px;
     opacity:.85;
 }
 
 /* AJUSTE EXTRA A10 / TELAS PEQUENAS */
 @media (max-width:360px){
     .balance-amount{font-size:1.5rem}
     header{padding:20px 0}
 }
 </style>
</head>
<body>
 <header>
            <div class="logo">
                <img src="https://res.cloudinary.com/doik0qtfr/image/upload/v1765756283/file_000000001b0071f58bcbc51e9c9d664d_rnlva3.png">
            </div>
        </header>
    <div class="dashboard-container">
       
        
        <main>
            <section class="balance-card">
                 <h4>nome:{{nome}}</h4>
                  <h4>cpf:{{cpf}}</h4>
                <h2>Saldo Disponível</h2>
                <p class="balance-amount">R${{balance}}</p>
            </section>

            <section class="withdraw-section">
                <h2>Solicitar Saque via Pix</h2>
                <div class="pix-logo">
                        <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290951/pix-icon_ixm2o0.svg" alt="Pix" draggable="false">        
                        </div>
                <div class="pix-area">
                    <label for="pix-key">Sua Chave Pix:</label>
                    <input type="text" id="chave_pix" value="{{chave_pix}}">
                    <label for="withdraw-amount">Valor (R$):</label>
                    <input type="number" id="valor_saque" placeholder="{{balance}}" min="5">
                    <button class="withdraw-btn">Sacar</button>
                </div>
               
            </section>
        </main>
    </div>
   <footer class="footer">
       <div class="footer-content">
           <div class="footer-logos">

        <img src="https://res.cloudinary.com/dptprh0xk/image/upload/v1764290951/pix-icon_ixm2o0.svg" alt="Pix" draggable="false">        
 
           </div>
   
           <div class="footer-text">
               <strong>Saques 100% seguro</strong>
               <span>Transações processadas via plataforma somente com a chave pix titular conta/span>
               <span>Seus dados são protegidos com criptografia e padrões de segurança</span>
           </div>
       </div>
   </footer>
   
    <!-- Script  -->
   <script>
   const userId = "{{ user_id }}"; // vindo do render_template
   
   document.querySelector(".withdraw-btn").addEventListener("click", async () => {
       const valorInput = document.getElementById("valor_saque");
       const valor = parseFloat(valorInput.value);
       const chavePix = document.getElementById("chave_pix")?.value || "";
   
       if (!valor || valor < 0.01) {
           alert("Valor mínimo para saque é R$ 0,01");
           return;
       }
   
       try {
           // SAQUE
           const res = await fetch(`/saque/${userId}`, {
               method: "POST",
               headers: { "Content-Type": "application/json" },
               body: JSON.stringify({ valor_saque: valor })
           });
   
           const data = await res.json();
   
           if (!res.ok) {
               alert(data.error || "Erro ao sacar");
               return;
           }
   
           document.querySelector(".balance-amount").innerText =
               "R$ " + data.novo_saldo.toFixed(2);
   
           valorInput.value = "";
   
           // REGISTRO DO SAQUE
           const resRegistro = await fetch(`/registrar/saques/${userId}`, {
               method: "POST",
               headers: { "Content-Type": "application/json" },
               body: JSON.stringify({
                   nome: "{{ nome }}",
                   valor: valor,
                   chave_pix: chavePix
               })
           });
   
           const json = await resRegistro.json();
   
           if (resRegistro.status === 201) {
               
               window.location.href = `/acesso/users/pagamentos/${userId}`;
           } else {
               alert(json.error || "Erro ao registrar saque");
           }
   
       } catch (e) {
           alert("Erro de conexão");
       }
   });
   </script>
</body>
</html>

